# OpenOCD configuration for XDS110 + TMS320F280039C

# XDS110 Debug Probe Configuration
adapter driver xds110
adapter speed 2000

# Transport selection
transport select jtag

# XDS110 specific settings
xds110 supply 3300

# Target configuration for TMS320F280039C
set _TARGETNAME f28039
set _ENDIAN little
set _CPUTAPID 0x0B97C02F

# JTAG TAP configuration
jtag newtap $_TARGETNAME cpu -irlen 38 -ircapture 0x1 -irmask 0x1 -expected-id $_CPUTAPID

# Target configuration
target create $_TARGETNAME.cpu cortex_m -endian $_ENDIAN -chain-position $_TARGETNAME.cpu

# Flash configuration for F280039C
# flash bank <name> <driver> <base> <size> <chip_width> <bus_width> <target>
flash bank flash0 stellaris 0x080000 0x80000 0 0 $_TARGETNAME.cpu

# GDB server configuration - enable multiple connections
gdb_port 3333
gdb_max_connections 3

# TCL server configuration  
tcl_port 6666

# Telnet server configuration
telnet_port 4444

# Logging
debug_level 1

# Reset configuration
reset_config trst_and_srst

# Initialization commands
init_reset run

# Work area for fast downloads
$_TARGETNAME.cpu configure -work-area-phys 0x20000000 -work-area-size 0x2000 -work-area-backup 0

# Flash programming speeds
adapter speed 1000

# Halt the target after reset
$_TARGETNAME.cpu configure -event reset-end { 
    halt 
}

# Additional debug configuration
$_TARGETNAME.cpu configure -event gdb-attach {
    echo "GDB client connected"
    halt
}

$_TARGETNAME.cpu configure -event gdb-detach {
    echo "GDB client disconnected" 
    resume
}